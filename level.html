<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>GRAB Level Preview</title>
		<style>
			body { margin: 0; }
		</style>
	</head>
	<body>
		<script type="x-shader/x-vertex" id="vertexShader">
			varying vec3 vWorldPosition;
			varying vec3 vNormal;

			void main()
			{
				vec4 worldPosition = modelMatrix * vec4(position, 1.0);
				vWorldPosition = worldPosition.xyz;

				vec4 worldNormal = modelMatrix * vec4(normal, 0.0);
				vNormal = worldNormal.xyz;

				gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
			}
		</script>

		<script type="x-shader/x-fragment" id="fragmentShader">
			varying vec3 vWorldPosition;
			varying vec3 vNormal;

			uniform sampler2D colorTexture;
			uniform float tileFactor;

			void main()
			{
				vec3 lightDirection = vec3(1.0, 1.0, 1.0);
				lightDirection = normalize(lightDirection);

				float lightFactor = 0.5 + dot(normalize(vNormal), lightDirection) * 0.5 + 0.5;

				vec4 color = vec4(lightFactor, lightFactor, lightFactor, 1.0);

				vec3 blendNormals = abs(vNormal);
				if(blendNormals.x > blendNormals.y && blendNormals.x > blendNormals.z)
				{
					color.rgb *= texture2D(colorTexture, vWorldPosition.zy * tileFactor).rgb;
				}
				else if(blendNormals.y > blendNormals.x && blendNormals.y > blendNormals.z)
				{
					color.rgb *= texture2D(colorTexture, vWorldPosition.xz * tileFactor).rgb;
				}
				else
				{
					color.rgb *= texture2D(colorTexture, vWorldPosition.xy * tileFactor).rgb;
				}

				gl_FragColor = color;
			}
		</script>

		<script type="text/javascript" src="https://cdn.rawgit.com/dcodeIO/protobuf.js/6.11.2/dist/protobuf.js"></script>
		<script type="module" src="level_viewer.js"></script>
	</body>
</html>